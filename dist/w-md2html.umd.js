/*!
 * w-md2html v1.0.22
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("path"),require("fs"),require("sharp"),require("marked"),require("marked-katex-extension"),require("marked-footnote"),require("highlight.js"),require("marked-highlight"),require("cheerio")):"function"==typeof define&&define.amd?define(["path","fs","sharp","marked","marked-katex-extension","marked-footnote","highlight.js","marked-highlight","cheerio"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-md2html"]=e(t.path,t.fs,t.sharp,t.marked,t["marked-katex-extension"],t["marked-footnote"],t.highlight.js,t["marked-highlight"],t.cheerio)}(this,function(t,e,n,r,i,o,a,l,c){"use strict";function s(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}),e.default=t,Object.freeze(e)}var u=s(c),f=Array.isArray,h="object"==typeof global&&global&&global.Object===Object&&global,p="object"==typeof self&&self&&self.Object===Object&&self,d=h||p||Function("return this")(),g=d.Symbol,y=Object.prototype,m=y.hasOwnProperty,b=y.toString,v=g?g.toStringTag:void 0;var _=Object.prototype.toString;var w=g?g.toStringTag:void 0;function j(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":w&&w in Object(t)?function(t){var e=m.call(t,v),n=t[v];try{t[v]=void 0;var r=!0}catch(t){}var i=b.call(t);return r&&(e?t[v]=n:delete t[v]),i}(t):function(t){return _.call(t)}(t)}function S(t){return null!=t&&"object"==typeof t}function x(t){return"symbol"==typeof t||S(t)&&"[object Symbol]"==j(t)}var T=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,k=/^\w*$/;function O(t,e){if(f(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!x(t))||(k.test(t)||!T.test(t)||null!=e&&t in Object(e))}function A(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function E(t){if(!A(t))return!1;var e=j(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var z,H=d["__core-js_shared__"],C=(z=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||""))?"Symbol(src)_1."+z:"";var B=Function.prototype.toString;function N(t){if(null!=t){try{return B.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var $=/^\[object .+?Constructor\]$/,D=Function.prototype,P=Object.prototype,F=D.toString,L=P.hasOwnProperty,I=RegExp("^"+F.call(L).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function R(t){return!(!A(t)||(e=t,C&&C in e))&&(E(t)?I:$).test(N(t));var e}function q(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return R(n)?n:void 0}var M=q(Object,"create");var U=Object.prototype.hasOwnProperty;var W=Object.prototype.hasOwnProperty;function G(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function V(t,e){return t===e||t!=t&&e!=e}function J(t,e){for(var n=t.length;n--;)if(V(t[n][0],e))return n;return-1}G.prototype.clear=function(){this.__data__=M?M(null):{},this.size=0},G.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},G.prototype.get=function(t){var e=this.__data__;if(M){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return U.call(e,t)?e[t]:void 0},G.prototype.has=function(t){var e=this.__data__;return M?void 0!==e[t]:W.call(e,t)},G.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=M&&void 0===e?"__lodash_hash_undefined__":e,this};var Q=Array.prototype.splice;function X(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}X.prototype.clear=function(){this.__data__=[],this.size=0},X.prototype.delete=function(t){var e=this.__data__,n=J(e,t);return!(n<0)&&(n==e.length-1?e.pop():Q.call(e,n,1),--this.size,!0)},X.prototype.get=function(t){var e=this.__data__,n=J(e,t);return n<0?void 0:e[n][1]},X.prototype.has=function(t){return J(this.__data__,t)>-1},X.prototype.set=function(t,e){var n=this.__data__,r=J(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var Y=q(d,"Map");function K(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Z(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Z.prototype.clear=function(){this.size=0,this.__data__={hash:new G,map:new(Y||X),string:new G}},Z.prototype.delete=function(t){var e=K(this,t).delete(t);return this.size-=e?1:0,e},Z.prototype.get=function(t){return K(this,t).get(t)},Z.prototype.has=function(t){return K(this,t).has(t)},Z.prototype.set=function(t,e){var n=K(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function tt(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(tt.Cache||Z),n}tt.Cache=Z;var et,nt,rt,it=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ot=/\\(\\)?/g,at=(et=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(it,function(t,n,r,i){e.push(r?i.replace(ot,"$1"):n||t)}),e},nt=tt(et,function(t){return 500===rt.size&&rt.clear(),t}),rt=nt.cache,nt),lt=at;function ct(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var st=g?g.prototype:void 0,ut=st?st.toString:void 0;function ft(t){if("string"==typeof t)return t;if(f(t))return ct(t,ft)+"";if(x(t))return ut?ut.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function ht(t){return null==t?"":ft(t)}function pt(t,e){return f(t)?t:O(t,e)?[t]:lt(ht(t))}function dt(t){if("string"==typeof t||x(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function gt(t,e){for(var n=0,r=(e=pt(e,t)).length;null!=t&&n<r;)t=t[dt(e[n++])];return n&&n==r?t:void 0}function yt(t,e,n){var r=null==t?void 0:gt(t,e);return void 0===r?n:r}function mt(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}var bt,vt=function(t,e,n){for(var r=-1,i=Object(t),o=n(t),a=o.length;a--;){var l=o[bt?a:++r];if(!1===e(i[l],l,i))break}return t};function _t(t){return S(t)&&"[object Arguments]"==j(t)}var wt=Object.prototype,jt=wt.hasOwnProperty,St=wt.propertyIsEnumerable,xt=_t(function(){return arguments}())?_t:function(t){return S(t)&&jt.call(t,"callee")&&!St.call(t,"callee")},Tt=xt;var kt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ot=kt&&"object"==typeof module&&module&&!module.nodeType&&module,At=Ot&&Ot.exports===kt?d.Buffer:void 0,Et=(At?At.isBuffer:void 0)||function(){return!1},zt=/^(?:0|[1-9]\d*)$/;function Ht(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&zt.test(t))&&t>-1&&t%1==0&&t<e}function Ct(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}var Bt={};function Nt(t){return function(e){return t(e)}}Bt["[object Float32Array]"]=Bt["[object Float64Array]"]=Bt["[object Int8Array]"]=Bt["[object Int16Array]"]=Bt["[object Int32Array]"]=Bt["[object Uint8Array]"]=Bt["[object Uint8ClampedArray]"]=Bt["[object Uint16Array]"]=Bt["[object Uint32Array]"]=!0,Bt["[object Arguments]"]=Bt["[object Array]"]=Bt["[object ArrayBuffer]"]=Bt["[object Boolean]"]=Bt["[object DataView]"]=Bt["[object Date]"]=Bt["[object Error]"]=Bt["[object Function]"]=Bt["[object Map]"]=Bt["[object Number]"]=Bt["[object Object]"]=Bt["[object RegExp]"]=Bt["[object Set]"]=Bt["[object String]"]=Bt["[object WeakMap]"]=!1;var $t="object"==typeof exports&&exports&&!exports.nodeType&&exports,Dt=$t&&"object"==typeof module&&module&&!module.nodeType&&module,Pt=Dt&&Dt.exports===$t&&h.process,Ft=function(){try{var t=Dt&&Dt.require&&Dt.require("util").types;return t||Pt&&Pt.binding&&Pt.binding("util")}catch(t){}}(),Lt=Ft&&Ft.isTypedArray,It=Lt?Nt(Lt):function(t){return S(t)&&Ct(t.length)&&!!Bt[j(t)]},Rt=Object.prototype.hasOwnProperty;function qt(t,e){var n=f(t),r=!n&&Tt(t),i=!n&&!r&&Et(t),o=!n&&!r&&!i&&It(t),a=n||r||i||o,l=a?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=l.length;for(var s in t)!e&&!Rt.call(t,s)||a&&("length"==s||i&&("offset"==s||"parent"==s)||o&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||Ht(s,c))||l.push(s);return l}var Mt=Object.prototype;function Ut(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Mt)}function Wt(t,e){return function(n){return t(e(n))}}var Gt=Wt(Object.keys,Object),Vt=Object.prototype.hasOwnProperty;function Jt(t){if(!Ut(t))return Gt(t);var e=[];for(var n in Object(t))Vt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Qt(t){return null!=t&&Ct(t.length)&&!E(t)}function Xt(t){return Qt(t)?qt(t):Jt(t)}var Yt=function(t,e){return function(n,r){if(null==n)return n;if(!Qt(n))return t(n,r);for(var i=n.length,o=e?i:-1,a=Object(n);(e?o--:++o<i)&&!1!==r(a[o],o,a););return n}}(function(t,e){return t&&vt(t,e,Xt)}),Kt=Yt;function Zt(t){return t}function te(t,e){var n;return(f(t)?mt:Kt)(t,"function"==typeof(n=e)?n:Zt)}function ee(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o}function ne(t,e,n){var r=t.length;return n=void 0===n?r:n,!e&&n>=r?t:ee(t,e,n)}var re=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");function ie(t){return re.test(t)}var oe=Ft&&Ft.isRegExp,ae=oe?Nt(oe):function(t){return S(t)&&"[object RegExp]"==j(t)};var le="\\ud800-\\udfff",ce="["+le+"]",se="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",ue="\\ud83c[\\udffb-\\udfff]",fe="[^"+le+"]",he="(?:\\ud83c[\\udde6-\\uddff]){2}",pe="[\\ud800-\\udbff][\\udc00-\\udfff]",de="(?:"+se+"|"+ue+")"+"?",ge="[\\ufe0e\\ufe0f]?",ye=ge+de+("(?:\\u200d(?:"+[fe,he,pe].join("|")+")"+ge+de+")*"),me="(?:"+[fe+se+"?",se,he,pe,ce].join("|")+")",be=RegExp(ue+"(?="+ue+")|"+me+ye,"g");function ve(t){return ie(t)?function(t){return t.match(be)||[]}(t):function(t){return t.split("")}(t)}function _e(t,e,n){return n&&"number"!=typeof n&&function(t,e,n){if(!A(n))return!1;var r=typeof e;return!!("number"==r?Qt(n)&&Ht(e,n.length):"string"==r&&e in n)&&V(n[e],t)}(t,e,n)&&(e=n=void 0),(n=void 0===n?4294967295:n>>>0)?(t=ht(t))&&("string"==typeof e||null!=e&&!ae(e))&&!(e=ft(e))&&ie(t)?ne(ve(t),0,n):t.split(e,n):[]}var we=/\s/;var je=/^\s+/;function Se(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&we.test(t.charAt(e)););return e}(t)+1).replace(je,""):t}function xe(t){return t!=t}function Te(t,e,n){return e==e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):function(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}(t,xe,n)}function ke(t,e,n){if((t=ht(t))&&(n||void 0===e))return Se(t);if(!t||!(e=ft(e)))return t;var r=ve(t),i=ve(e),o=function(t,e){for(var n=-1,r=t.length;++n<r&&Te(e,t[n],0)>-1;);return n}(r,i),a=function(t,e){for(var n=t.length;n--&&Te(e,t[n],0)>-1;);return n}(r,i)+1;return ne(r,o,a).join("")}var Oe=Array.prototype.join;function Ae(t,e){return null==t?"":Oe.call(t,e)}var Ee=/^[-+]0x[0-9a-f]+$/i,ze=/^0b[01]+$/i,He=/^0o[0-7]+$/i,Ce=parseInt;function Be(t){if("number"==typeof t)return t;if(x(t))return NaN;if(A(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=A(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Se(t);var n=ze.test(t);return n||He.test(t)?Ce(t.slice(2),n?2:8):Ee.test(t)?NaN:+t}var Ne=1/0;function $e(t){return t?(t=Be(t))===Ne||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function De(t){var e=$e(t),n=e%1;return e==e?n?e-n:e:0}function Pe(t,e,n){var r=null==t?0:t.length;return r?ee(t,(e=n||void 0===e?1:De(e))<0?0:e,r):[]}var Fe=q(d,"DataView"),Le=q(d,"Promise"),Ie=q(d,"Set"),Re=q(d,"WeakMap"),qe="[object Map]",Me="[object Promise]",Ue="[object Set]",We="[object WeakMap]",Ge="[object DataView]",Ve=N(Fe),Je=N(Y),Qe=N(Le),Xe=N(Ie),Ye=N(Re),Ke=j;(Fe&&Ke(new Fe(new ArrayBuffer(1)))!=Ge||Y&&Ke(new Y)!=qe||Le&&Ke(Le.resolve())!=Me||Ie&&Ke(new Ie)!=Ue||Re&&Ke(new Re)!=We)&&(Ke=function(t){var e=j(t),n="[object Object]"==e?t.constructor:void 0,r=n?N(n):"";if(r)switch(r){case Ve:return Ge;case Je:return qe;case Qe:return Me;case Xe:return Ue;case Ye:return We}return e});var Ze=Ke;function tn(t){return function(e){return null==e?void 0:e[t]}}var en=tn("length"),nn="\\ud800-\\udfff",rn="["+nn+"]",on="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",an="\\ud83c[\\udffb-\\udfff]",ln="[^"+nn+"]",cn="(?:\\ud83c[\\udde6-\\uddff]){2}",sn="[\\ud800-\\udbff][\\udc00-\\udfff]",un="(?:"+on+"|"+an+")"+"?",fn="[\\ufe0e\\ufe0f]?",hn=fn+un+("(?:\\u200d(?:"+[ln,cn,sn].join("|")+")"+fn+un+")*"),pn="(?:"+[ln+on+"?",on,cn,sn,rn].join("|")+")",dn=RegExp(an+"(?="+an+")|"+pn+hn,"g");function gn(t){return ie(t)?function(t){for(var e=dn.lastIndex=0;dn.test(t);)++e;return e}(t):en(t)}function yn(t){if(null==t)return 0;if(Qt(t))return"string"==typeof(e=t)||!f(e)&&S(e)&&"[object String]"==j(e)?gn(t):t.length;var e,n=Ze(t);return"[object Map]"==n||"[object Set]"==n?t.size:Jt(t).length}function mn(t){return!0===(e=t)||!1===e||S(e)&&"[object Boolean]"==j(e);var e}function bn(t){return"[object String]"===Object.prototype.toString.call(t)}function vn(t){return!(!bn(t)||""===t)}function _n(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}function wn(t){let e,n=Object.prototype.toString.call(t);if(e="[object Promise]"===n,e)return!0;if("[object Function]"!==n)return!1;try{e="function"!=typeof t.subscribe&&"function"==typeof t.then}catch(t){}return e}function jn(t,e,n){if(!vn(t))return"";if(!vn(e))return"";if(!bn(n))return"";return String(t).replaceAll(e,n)}function Sn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var xn={exports:{}};!function(t,e){!function(){if("string"!=typeof __filename||"string"!=typeof __dirname){if(this.Tautologistics){if(this.Tautologistics.NodeHtmlParser)return}else this.Tautologistics={};this.Tautologistics.NodeHtmlParser={},e=this.Tautologistics.NodeHtmlParser}var t,n,r,i={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag"};function o(t,e){this._options=e||{},null==this._options.includeLocation&&(this._options.includeLocation=!1),this.validateHandler(t),this._handler=t,this.reset()}function a(t){a.super_.call(this,t,{ignoreWhitespace:!0,verbose:!1,enforceEmptyTags:!1})}function l(t,e){this.reset(),this._options=e||{},null==this._options.ignoreWhitespace&&(this._options.ignoreWhitespace=!1),null==this._options.verbose&&(this._options.verbose=!0),null==this._options.enforceEmptyTags&&(this._options.enforceEmptyTags=!0),"function"==typeof t&&(this._callback=t)}o._reTrim=/(^\s+|\s+$)/g,o._reTrimComment=/(^\!--|--$)/g,o._reWhitespace=/\s/g,o._reTagName=/^\s*(\/?)\s*([^\s\/]+)/,o._reAttrib=/([^=<>\"\'\s]+)\s*=\s*"([^"]*)"|([^=<>\"\'\s]+)\s*=\s*'([^']*)'|([^=<>\"\'\s]+)\s*=\s*([^'"\s]+)|([^=<>\"\'\s\/]+)/g,o._reTags=/[\<\>]/g,o.prototype.parseComplete=function(t){this.reset(),this.parseChunk(t),this.done()},o.prototype.parseChunk=function(t){this._done&&this.handleError(new Error("Attempted to parse chunk after parsing already done")),this._buffer+=t,this.parseTags()},o.prototype.done=function(){if(!this._done){if(this._done=!0,this._buffer.length){var t=this._buffer;this._buffer="";var e={raw:t,data:this._parseState==i.Text?t:t.replace(o._reTrim,""),type:this._parseState};this._parseState!=i.Tag&&this._parseState!=i.Script&&this._parseState!=i.Style||(e.name=this.parseTagName(e.data)),this.parseAttribs(e),this._elements.push(e)}this.writeHandler(),this._handler.done()}},o.prototype.reset=function(){this._buffer="",this._done=!1,this._elements=[],this._elementsCurrent=0,this._current=0,this._next=0,this._location={row:0,col:0,charOffset:0,inBuffer:0},this._parseState=i.Text,this._prevTagSep="",this._tagStack=[],this._handler.reset()},o.prototype._options=null,o.prototype._handler=null,o.prototype._buffer=null,o.prototype._done=!1,o.prototype._elements=null,o.prototype._elementsCurrent=0,o.prototype._current=0,o.prototype._next=0,o.prototype._location=null,o.prototype._parseState=i.Text,o.prototype._prevTagSep="",o.prototype._tagStack=null,o.prototype.parseTagAttribs=function(t){for(var e=t.length,n=0;n<e;){var r=t[n++];r.type!=i.Tag&&r.type!=i.Script&&r.type!=i.style||this.parseAttribs(r)}return t},o.prototype.parseAttribs=function(t){if(t.type==i.Script||t.type==i.Style||t.type==i.Tag){var e,n=t.data.split(o._reWhitespace,1)[0],r=t.data.substring(n.length);if(!(r.length<1))for(o._reAttrib.lastIndex=0;e=o._reAttrib.exec(r);)null==t.attribs&&(t.attribs={}),"string"==typeof e[1]&&e[1].length?t.attribs[e[1]]=e[2]:"string"==typeof e[3]&&e[3].length?t.attribs[e[3].toString()]=e[4].toString():"string"==typeof e[5]&&e[5].length?t.attribs[e[5]]=e[6]:"string"==typeof e[7]&&e[7].length&&(t.attribs[e[7]]=e[7])}},o.prototype.parseTagName=function(t){if(null==t||""==t)return"";var e=o._reTagName.exec(t);return e?(e[1]?"/":"")+e[2]:""},o.prototype.parseTags=function(){for(var t=this._buffer.length-1;o._reTags.test(this._buffer);){this._next=o._reTags.lastIndex-1;var e=this._buffer.charAt(this._next),n=this._buffer.substring(this._current,this._next),r={raw:n,data:this._parseState==i.Text?n:n.replace(o._reTrim,""),type:this._parseState},a=this.parseTagName(r.data);if(this._tagStack.length)if(this._tagStack[this._tagStack.length-1]==i.Script){if("/script"==a.toLowerCase())this._tagStack.pop();else if(0!=r.raw.indexOf("!--"))if(r.type=i.Text,this._elements.length&&this._elements[this._elements.length-1].type==i.Text)(l=this._elements[this._elements.length-1]).raw=l.data=l.raw+this._prevTagSep+r.raw,r.raw=r.data=""}else if(this._tagStack[this._tagStack.length-1]==i.Style){if("/style"==a.toLowerCase())this._tagStack.pop();else if(0!=r.raw.indexOf("!--"))if(r.type=i.Text,this._elements.length&&this._elements[this._elements.length-1].type==i.Text){var l=this._elements[this._elements.length-1];""!=r.raw?(l.raw=l.data=l.raw+this._prevTagSep+r.raw,r.raw=r.data=""):l.raw=l.data=l.raw+this._prevTagSep}else""!=r.raw&&(r.raw=r.data=r.raw)}else if(this._tagStack[this._tagStack.length-1]==i.Comment){var c=r.raw.length;if("-"==r.raw.charAt(c-2)&&"-"==r.raw.charAt(c-1)&&">"==e)if(this._tagStack.pop(),this._elements.length&&this._elements[this._elements.length-1].type==i.Comment)(l=this._elements[this._elements.length-1]).raw=l.data=(l.raw+r.raw).replace(o._reTrimComment,""),r.raw=r.data="",r.type=i.Text;else r.type=i.Comment;else if(r.type=i.Comment,this._elements.length&&this._elements[this._elements.length-1].type==i.Comment)(l=this._elements[this._elements.length-1]).raw=l.data=l.raw+r.raw+e,r.raw=r.data="",r.type=i.Text;else r.raw=r.data=r.raw+e}if(r.type==i.Tag){r.name=a;var s=a.toLowerCase();if(0==r.raw.indexOf("!--")){r.type=i.Comment,delete r.name;c=r.raw.length;"-"==r.raw.charAt(c-1)&&"-"==r.raw.charAt(c-2)&&">"==e?r.raw=r.data=r.raw.replace(o._reTrimComment,""):(r.raw+=e,this._tagStack.push(i.Comment))}else 0==r.raw.indexOf("!")||0==r.raw.indexOf("?")?r.type=i.Directive:"script"==s?(r.type=i.Script,"/"!=r.data.charAt(r.data.length-1)&&this._tagStack.push(i.Script)):"/script"==s?r.type=i.Script:"style"==s?(r.type=i.Style,"/"!=r.data.charAt(r.data.length-1)&&this._tagStack.push(i.Style)):"/style"==s&&(r.type=i.Style);r.name&&"/"==r.name.charAt(0)&&(r.data=r.name)}""==r.raw&&r.type==i.Text||(this._options.includeLocation&&!r.location&&(r.location=this.getLocation(r.type==i.Tag)),this.parseAttribs(r),this._elements.push(r),r.type!=i.Text&&r.type!=i.Comment&&r.type!=i.Directive&&"/"==r.data.charAt(r.data.length-1)&&this._elements.push({raw:"/"+r.name,data:"/"+r.name,name:"/"+r.name,type:r.type})),this._parseState="<"==e?i.Tag:i.Text,this._current=this._next+1,this._prevTagSep=e}this._options.includeLocation&&(this.getLocation(),this._location.row+=this._location.inBuffer,this._location.inBuffer=0,this._location.charOffset=0),this._buffer=this._current<=t?this._buffer.substring(this._current):"",this._current=0,this.writeHandler()},o.prototype.getLocation=function(t){for(var e,n=this._location,r=this._current-(t?1:0),i=t&&0==n.charOffset&&0==this._current;n.charOffset<r;n.charOffset++)"\n"==(e=this._buffer.charAt(n.charOffset))?(n.inBuffer++,n.col=0):"\r"!=e&&n.col++;return{line:n.row+n.inBuffer+1,col:n.col+(i?0:1)}},o.prototype.validateHandler=function(t){if("object"!=typeof t)throw new Error("Handler is not an object");if("function"!=typeof t.reset)throw new Error("Handler method 'reset' is invalid");if("function"!=typeof t.done)throw new Error("Handler method 'done' is invalid");if("function"!=typeof t.writeTag)throw new Error("Handler method 'writeTag' is invalid");if("function"!=typeof t.writeText)throw new Error("Handler method 'writeText' is invalid");if("function"!=typeof t.writeComment)throw new Error("Handler method 'writeComment' is invalid");if("function"!=typeof t.writeDirective)throw new Error("Handler method 'writeDirective' is invalid")},o.prototype.writeHandler=function(t){if(t=!!t,!this._tagStack.length||t)for(;this._elements.length;){var e=this._elements.shift();switch(e.type){case i.Comment:this._handler.writeComment(e);break;case i.Directive:this._handler.writeDirective(e);break;case i.Text:this._handler.writeText(e);break;default:this._handler.writeTag(e)}}},o.prototype.handleError=function(t){if("function"!=typeof this._handler.error)throw t;this._handler.error(t)},t=a,(r=function(){}).prototype=(n=l).prototype,t.super_=n,t.prototype=new r,t.prototype.constructor=t,a.prototype.done=function(){var t,e={},n=c.getElementsByTagName(function(t){return"rss"==t||"feed"==t},this.dom,!1);if(n.length&&(t=n[0]),t){if("rss"==t.name){e.type="rss",t=t.children[0],e.id="";try{e.title=c.getElementsByTagName("title",t.children,!1)[0].children[0].data}catch(t){}try{e.link=c.getElementsByTagName("link",t.children,!1)[0].children[0].data}catch(t){}try{e.description=c.getElementsByTagName("description",t.children,!1)[0].children[0].data}catch(t){}try{e.updated=new Date(c.getElementsByTagName("lastBuildDate",t.children,!1)[0].children[0].data)}catch(t){}try{e.author=c.getElementsByTagName("managingEditor",t.children,!1)[0].children[0].data}catch(t){}e.items=[],c.getElementsByTagName("item",t.children).forEach(function(t,n,r){var i={};try{i.id=c.getElementsByTagName("guid",t.children,!1)[0].children[0].data}catch(t){}try{i.title=c.getElementsByTagName("title",t.children,!1)[0].children[0].data}catch(t){}try{i.link=c.getElementsByTagName("link",t.children,!1)[0].children[0].data}catch(t){}try{i.description=c.getElementsByTagName("description",t.children,!1)[0].children[0].data}catch(t){}try{i.pubDate=new Date(c.getElementsByTagName("pubDate",t.children,!1)[0].children[0].data)}catch(t){}e.items.push(i)})}else{e.type="atom";try{e.id=c.getElementsByTagName("id",t.children,!1)[0].children[0].data}catch(t){}try{e.title=c.getElementsByTagName("title",t.children,!1)[0].children[0].data}catch(t){}try{e.link=c.getElementsByTagName("link",t.children,!1)[0].attribs.href}catch(t){}try{e.description=c.getElementsByTagName("subtitle",t.children,!1)[0].children[0].data}catch(t){}try{e.updated=new Date(c.getElementsByTagName("updated",t.children,!1)[0].children[0].data)}catch(t){}try{e.author=c.getElementsByTagName("email",t.children,!0)[0].children[0].data}catch(t){}e.items=[],c.getElementsByTagName("entry",t.children).forEach(function(t,n,r){var i={};try{i.id=c.getElementsByTagName("id",t.children,!1)[0].children[0].data}catch(t){}try{i.title=c.getElementsByTagName("title",t.children,!1)[0].children[0].data}catch(t){}try{i.link=c.getElementsByTagName("link",t.children,!1)[0].attribs.href}catch(t){}try{i.description=c.getElementsByTagName("summary",t.children,!1)[0].children[0].data}catch(t){}try{i.pubDate=new Date(c.getElementsByTagName("updated",t.children,!1)[0].children[0].data)}catch(t){}e.items.push(i)})}this.dom=e}a.super_.prototype.done.call(this)},l._emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1},l.reWhitespace=/^\s*$/,l.prototype.dom=null,l.prototype.reset=function(){this.dom=[],this._done=!1,this._tagStack=[],this._tagStack.last=function(){return this.length?this[this.length-1]:null}},l.prototype.done=function(){this._done=!0,this.handleCallback(null)},l.prototype.writeTag=function(t){this.handleElement(t)},l.prototype.writeText=function(t){this._options.ignoreWhitespace&&l.reWhitespace.test(t.data)||this.handleElement(t)},l.prototype.writeComment=function(t){this.handleElement(t)},l.prototype.writeDirective=function(t){this.handleElement(t)},l.prototype.error=function(t){this.handleCallback(t)},l.prototype._options=null,l.prototype._callback=null,l.prototype._done=!1,l.prototype._tagStack=null,l.prototype.handleCallback=function(t){if("function"==typeof this._callback)this._callback(t,this.dom);else if(t)throw t},l.prototype.isEmptyTag=function(t){var e=t.name.toLowerCase();return"/"==e.charAt(0)&&(e=e.substring(1)),this._options.enforceEmptyTags&&!!l._emptyTags[e]},l.prototype.handleElement=function(t){if(this._done&&this.handleCallback(new Error("Writing to the handler after done() called is not allowed without a reset()")),this._options.verbose||(delete t.raw,"tag"!=t.type&&"script"!=t.type&&"style"!=t.type||delete t.data),this._tagStack.last())if(t.type!=i.Text&&t.type!=i.Comment&&t.type!=i.Directive)if("/"==t.name.charAt(0)){var e=t.name.substring(1);if(!this.isEmptyTag(t)){for(var n=this._tagStack.length-1;n>-1&&this._tagStack[n--].name!=e;);if(n>-1||this._tagStack[0].name==e)for(;n<this._tagStack.length-1;)this._tagStack.pop()}}else this._tagStack.last().children||(this._tagStack.last().children=[]),this._tagStack.last().children.push(t),this.isEmptyTag(t)||this._tagStack.push(t);else this._tagStack.last().children||(this._tagStack.last().children=[]),this._tagStack.last().children.push(t);else t.type!=i.Text&&t.type!=i.Comment&&t.type!=i.Directive?"/"!=t.name.charAt(0)&&(this.dom.push(t),this.isEmptyTag(t)||this._tagStack.push(t)):this.dom.push(t)};var c={testElement:function(t,e){if(!e)return!1;for(var n in t)if("tag_name"==n){if("tag"!=e.type&&"script"!=e.type&&"style"!=e.type)return!1;if(!t.tag_name(e.name))return!1}else if("tag_type"==n){if(!t.tag_type(e.type))return!1}else if("tag_contains"==n){if("text"!=e.type&&"comment"!=e.type&&"directive"!=e.type)return!1;if(!t.tag_contains(e.data))return!1}else if(!e.attribs||!t[n](e.attribs[n]))return!1;return!0},getElements:function(t,e,n,r){if(n=null==n||!!n,r=isNaN(parseInt(r))?-1:parseInt(r),!e)return[];var i,o=[];function a(t){return function(e){return e==t}}for(var l in t)"function"!=typeof t[l]&&(t[l]=a(t[l]));if(c.testElement(t,e)&&o.push(e),r>=0&&o.length>=r)return o;if(n&&e.children)i=e.children;else{if(!(e instanceof Array))return o;i=e}for(var s=0;s<i.length&&(o=o.concat(c.getElements(t,i[s],n,r)),!(r>=0&&o.length>=r));s++);return o},getElementById:function(t,e,n){var r=c.getElements({id:t},e,n,1);return r.length?r[0]:null},getElementsByTagName:function(t,e,n,r){return c.getElements({tag_name:t},e,n,r)},getElementsByTagType:function(t,e,n,r){return c.getElements({tag_type:t},e,n,r)}};e.Parser=o,e.DefaultHandler=l,e.RssHandler=a,e.ElementType=i,e.DomUtils=c}()}(0,xn.exports);var Tn=Sn(xn.exports);function kn(){return"undefined"!=typeof self?self:"undefined"!=typeof window&&void 0!==window.document?window:"undefined"!=typeof global?global:null}function On(t){let e=null;if(!vn(t))return"";let n=function(){let t=kn();return Tn||t.htmlparser||t.Tautologistics.NodeHtmlParser}(),r=new n.DefaultHandler(function(t,n){t&&(e=t)});if(new n.Parser(r).parseComplete(t),null!==e)return e;let i=[];return function t(e){te(e,e=>{yn(e.children)>0&&t(e.children),"text"===e.type&&i.push(e.data)})}(r.dom),i=Ae(i,""),i}function An(t){return"[object Array]"===Object.prototype.toString.call(t)}function En(t){return"[object Object]"===Object.prototype.toString.call(t)}function zn(t,e){let n=function(){let t,e,n=new Promise(function(){t=arguments[0],e=arguments[1]});return n.resolve=t,n.reject=e,n}();if(!An(t)&&!En(t))return n.reject("rs is not an array or object"),n;let r=!1;if(En(t)){r=!0;let e=[];te(t,(t,n)=>{e.push({k:n,v:t})}),t=e}_n(e)||(e=function(t){return t});let i=-1,o=[];return t.reduce(function(t,n){return t.then(function(t){o.push(t),i+=1;let a=i,l=n;return r&&(a=n.k,l=n.v),_n(e)?e(l,a):l})},Promise.resolve()).then(function(t){o.push(t),o=Pe(o),n.resolve(o)}).catch(function(t){n.reject(t)}),n}function Hn(t){return t!=t}function Cn(t){let e=!1;if(vn(t))e=!isNaN(Number(t));else if(function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)){if(Hn(t))return!1;e=!0}return e}function Bn(t){if(!Cn(t))return 0;return $e(t)}function Nn(t){return!!Cn(t)&&(t=Bn(t),"number"==typeof(e=t)&&e==De(e));var e}var $n=d.isFinite,Dn=Math.min;var Pn=function(t){var e=Math[t];return function(t,n){if(t=Be(t),(n=null==n?0:Dn(De(n),292))&&$n(t)){var r=(ht(t)+"e").split("e");return+((r=(ht(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}("round"),Fn=Pn;function Ln(t){if(!Cn(t))return 0;t=Bn(t);let e=Fn(t);return"0"===String(e)?0:e}function In(t){if(!Nn(t))return!1;return Ln(t)>=0}function Rn(t,e){if(!vn(t))return"";if(!In(e))return"";if(0===(e=Ln(e)))return"";let n=t.length-e;return n<0&&(n=0),t.substring(n,n+e)}function qn(t,e){return vn(t)&&In(e)?0===(e=Ln(e))?t:function(t,e){return vn(t)&&In(e)?0===(e=Ln(e))?"":t.substring(0,e):""}(t,t.length-e):""}function Mn(t){if(!vn(t))return{path:"",isRoot:!1};for(;t.indexOf("\\\\")>=0;)t=t.replace("\\\\","\\");for(;t.indexOf("//")>=0;)t=t.replace("//","/");if(":"===Rn(t,1))return{path:`${t}\\`,isRoot:!0};if("\\"===Rn(t,1)){let e=qn(t,1);return":"===Rn(e,1)?{path:t,isRoot:!0}:{path:e,isRoot:!1}}if("/"===Rn(t,1)){let e=qn(t,1);return 0===e.length?{path:t,isRoot:!0}:{path:e,isRoot:!1}}return{path:t,isRoot:!1}}function Un(t){if(!vn(t))return"";let e=Mn(t);if(e.isRoot)return e.path;let n=e.path;try{n=n.split("\\").pop().split("/").pop()}catch(t){}return n}function Wn(t){if(!vn(t))return"";let e=Un(t),n=_e(e,".");if(yn(n)<=1)return e;let r="";try{n=(l=null==(i=n)?0:i.length)?ee(i,0,(o=l-(o=a||void 0===o?1:De(o)))<0?0:o):[],r=Ae(n,".")}catch(t){}var i,o,a,l;return r}function Gn(t){if(!vn(t))return"";let e=Mn(t);if(e.isRoot)return e.path;let n=Un(t=e.path);if(!vn(n))return t;let r=Mn(t=qn(t,n.length));return r.isRoot,r.path}function Vn(t){return function(t,e={}){let n=yt(e,"fs");return!!n.existsSync(t)&&!n.lstatSync(t).isDirectory()&&!n.lstatSync(t).isSymbolicLink()}(t,{fs:e})}function Jn(t){return ht(t).toLowerCase()}function Qn(t){var e=this.__data__=new X(t);this.size=e.size}Qn.prototype.clear=function(){this.__data__=new X,this.size=0},Qn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Qn.prototype.get=function(t){return this.__data__.get(t)},Qn.prototype.has=function(t){return this.__data__.has(t)},Qn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof X){var r=n.__data__;if(!Y||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Z(r)}return n.set(t,e),this.size=n.size,this};var Xn=function(){try{var t=q(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Yn=Xn;function Kn(t,e,n){"__proto__"==e&&Yn?Yn(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}var Zn=Object.prototype.hasOwnProperty;function tr(t,e,n){var r=t[e];Zn.call(t,e)&&V(r,n)&&(void 0!==n||e in t)||Kn(t,e,n)}function er(t,e,n,r){var i=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var l=e[o],c=r?r(n[l],t[l],l,n,t):void 0;void 0===c&&(c=t[l]),i?Kn(n,l,c):tr(n,l,c)}return n}var nr=Object.prototype.hasOwnProperty;function rr(t){if(!A(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=Ut(t),n=[];for(var r in t)("constructor"!=r||!e&&nr.call(t,r))&&n.push(r);return n}function ir(t){return Qt(t)?qt(t,!0):rr(t)}var or="object"==typeof exports&&exports&&!exports.nodeType&&exports,ar=or&&"object"==typeof module&&module&&!module.nodeType&&module,lr=ar&&ar.exports===or?d.Buffer:void 0,cr=lr?lr.allocUnsafe:void 0;function sr(){return[]}var ur=Object.prototype.propertyIsEnumerable,fr=Object.getOwnPropertySymbols,hr=fr?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}(fr(t),function(e){return ur.call(t,e)}))}:sr,pr=hr;function dr(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var gr=Wt(Object.getPrototypeOf,Object),yr=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)dr(e,pr(t)),t=gr(t);return e}:sr,mr=yr;function br(t,e,n){var r=e(t);return f(t)?r:dr(r,n(t))}function vr(t){return br(t,Xt,pr)}function _r(t){return br(t,ir,mr)}var wr=Object.prototype.hasOwnProperty;var jr=d.Uint8Array;function Sr(t){var e=new t.constructor(t.byteLength);return new jr(e).set(new jr(t)),e}var xr=/\w*$/;var Tr=g?g.prototype:void 0,kr=Tr?Tr.valueOf:void 0;function Or(t,e,n){var r,i=t.constructor;switch(e){case"[object ArrayBuffer]":return Sr(t);case"[object Boolean]":case"[object Date]":return new i(+t);case"[object DataView]":return function(t,e){var n=e?Sr(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(t,e){var n=e?Sr(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,n);case"[object Map]":case"[object Set]":return new i;case"[object Number]":case"[object String]":return new i(t);case"[object RegExp]":return function(t){var e=new t.constructor(t.source,xr.exec(t));return e.lastIndex=t.lastIndex,e}(t);case"[object Symbol]":return r=t,kr?Object(kr.call(r)):{}}}var Ar=Object.create,Er=function(){function t(){}return function(e){if(!A(e))return{};if(Ar)return Ar(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),zr=Er;var Hr=Ft&&Ft.isMap,Cr=Hr?Nt(Hr):function(t){return S(t)&&"[object Map]"==Ze(t)};var Br=Ft&&Ft.isSet,Nr=Br?Nt(Br):function(t){return S(t)&&"[object Set]"==Ze(t)},$r="[object Arguments]",Dr="[object Function]",Pr="[object Object]",Fr={};function Lr(t,e,n,r,i,o){var a,l=1&e,c=2&e,s=4&e;if(n&&(a=i?n(t,r,i,o):n(t)),void 0!==a)return a;if(!A(t))return t;var u=f(t);if(u){if(a=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&wr.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!l)return function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}(t,a)}else{var h=Ze(t),p=h==Dr||"[object GeneratorFunction]"==h;if(Et(t))return function(t,e){if(e)return t.slice();var n=t.length,r=cr?cr(n):new t.constructor(n);return t.copy(r),r}(t,l);if(h==Pr||h==$r||p&&!i){if(a=c||p?{}:function(t){return"function"!=typeof t.constructor||Ut(t)?{}:zr(gr(t))}(t),!l)return c?function(t,e){return er(t,mr(t),e)}(t,function(t,e){return t&&er(e,ir(e),t)}(a,t)):function(t,e){return er(t,pr(t),e)}(t,function(t,e){return t&&er(e,Xt(e),t)}(a,t))}else{if(!Fr[h])return i?t:{};a=Or(t,h,l)}}o||(o=new Qn);var d=o.get(t);if(d)return d;o.set(t,a),Nr(t)?t.forEach(function(r){a.add(Lr(r,e,n,r,t,o))}):Cr(t)&&t.forEach(function(r,i){a.set(i,Lr(r,e,n,i,t,o))});var g=u?void 0:(s?c?_r:vr:c?ir:Xt)(t);return mt(g||t,function(r,i){g&&(r=t[i=r]),tr(a,i,Lr(r,e,n,i,t,o))}),a}Fr[$r]=Fr["[object Array]"]=Fr["[object ArrayBuffer]"]=Fr["[object DataView]"]=Fr["[object Boolean]"]=Fr["[object Date]"]=Fr["[object Float32Array]"]=Fr["[object Float64Array]"]=Fr["[object Int8Array]"]=Fr["[object Int16Array]"]=Fr["[object Int32Array]"]=Fr["[object Map]"]=Fr["[object Number]"]=Fr[Pr]=Fr["[object RegExp]"]=Fr["[object Set]"]=Fr["[object String]"]=Fr["[object Symbol]"]=Fr["[object Uint8Array]"]=Fr["[object Uint8ClampedArray]"]=Fr["[object Uint16Array]"]=Fr["[object Uint32Array]"]=!0,Fr["[object Error]"]=Fr[Dr]=Fr["[object WeakMap]"]=!1;function Ir(t){return Lr(t,5)}let Rr=(t,e)=>{let n=t.toString("base64"),r=(t=>"png"===(t=Jn(t))?"image/png":"jpg"===t||"jpeg"===t?"image/jpeg":"gif"===t?"image/gif":"svg"===t?"image/svg+xml":"webp"===t?"image/webp":"application/octet-stream")(e);return`data:${r};base64,${n}`},qr=async(t,r,i={})=>{if(!Vn(t))throw new Error(`fpInp[${t}] does not exist`);let o=yt(i,"funGetWidth"),a=yt(i,"funGetHeight"),l=yt(i,"funGetSize"),c=yt(i,"cropLeft"),s=yt(i,"cropTop"),u=yt(i,"cropWidth"),f=yt(i,"cropHeight"),h=yt(i,"density");Cn(h)||(h=96),h=Ln(h);let p=yt(i,"returnBase64");mn(p)||(p=!1);let d=function(t){if(!vn(t))return"";let e=_e(Un(t),".");if(yn(e)<=1)return"";let n="";try{n=(i=null==(r=e)?0:r.length)?r[i-1]:void 0}catch(t){}var r,i;return n}(r);d=Jn(d);let g=e.readFileSync(t),y=null,m=null;if(_n(l)||_n(o)||_n(a)){let t=await n(g).metadata();if(_n(l)){let e=l(Ir(t));if(wn(e)&&(e=await e),!Cn(yt(e,"width")))throw new Error("invalid ret.width for funGetSize");if(!Cn(yt(e,"height")))throw new Error("invalid ret.height for funGetSize");y=Ln(e.width),m=Ln(e.height)}else _n(o)?(y=o(Ir(t)),wn(y)&&(y=await y),y=Ln(y)):_n(a)&&(m=a(Ir(t)),wn(m)&&(m=await m),m=Ln(m))}let b=await n(g,{density:h}),v=Cn(y),_=Cn(m),w=Cn(c)&&Cn(s)&&Cn(u)&&Cn(f);v&&_?b=b.resize({width:y,height:m,withoutEnlargement:!0}):v&&!_?b=b.resize({width:y,withoutEnlargement:!0}):!v&&_&&(b=b.resize({height:m,withoutEnlargement:!0})),w&&(c=Ln(c),s=Ln(s),u=Ln(u),f=Ln(f),b=b.extract({left:c,top:s,width:u,height:f}));let j={png:()=>b.png({compressionLevel:9,adaptiveFiltering:!1,palette:!1,quality:100,colors:256,...i}),jpg:()=>b.flatten({background:yt(i,"background","#fff")}).jpeg({quality:100,progressive:!1,chromaSubsampling:"4:2:0",optimiseCoding:!0,mozjpeg:!1,overshootDeringing:!1,...i}),jpeg:()=>b.flatten({background:yt(i,"background","#fff")}).jpeg({quality:100,progressive:!1,chromaSubsampling:"4:2:0",optimiseCoding:!0,mozjpeg:!1,overshootDeringing:!1,...i}),webp:()=>b.webp({quality:100,alphaQuality:100,lossless:!0,...i}),avif:()=>b.avif({quality:50,lossless:!1,speed:5,chromaSubsampling:"4:2:0",...i}),gif:()=>b.gif({effort:7,interlace:!1,...i}),tiff:()=>b.tiff({quality:100,compression:"jpeg",predictor:"horizontal",pyramid:!1,tile:!1,...i}),bmp:()=>b.bmp({...i})};var S,x;x=d,b=En(S=j)&&(vn(x)||Cn(x))&&x in S?j[d]():b.toFormat(d);let T=await b.toBuffer();if(p){return Rr(T,d)}return e.writeFileSync(r,T),"ok"},Mr=async(t,e,n={})=>{let r={...n,cropLeft:null,cropTop:null,cropWidth:null,cropHeight:null,returnBase64:!0};return await qr(t,`${t}.${e}`,r)};function Ur(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Z;++e<n;)this.add(t[e])}function Wr(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function Gr(t,e){return t.has(e)}Ur.prototype.add=Ur.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Ur.prototype.has=function(t){return this.__data__.has(t)};function Vr(t,e,n,r,i,o){var a=1&n,l=t.length,c=e.length;if(l!=c&&!(a&&c>l))return!1;var s=o.get(t),u=o.get(e);if(s&&u)return s==e&&u==t;var f=-1,h=!0,p=2&n?new Ur:void 0;for(o.set(t,e),o.set(e,t);++f<l;){var d=t[f],g=e[f];if(r)var y=a?r(g,d,f,e,t,o):r(d,g,f,t,e,o);if(void 0!==y){if(y)continue;h=!1;break}if(p){if(!Wr(e,function(t,e){if(!Gr(p,e)&&(d===t||i(d,t,n,r,o)))return p.push(e)})){h=!1;break}}else if(d!==g&&!i(d,g,n,r,o)){h=!1;break}}return o.delete(t),o.delete(e),h}function Jr(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}function Qr(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var Xr=g?g.prototype:void 0,Yr=Xr?Xr.valueOf:void 0;var Kr=Object.prototype.hasOwnProperty;var Zr="[object Arguments]",ti="[object Array]",ei="[object Object]",ni=Object.prototype.hasOwnProperty;function ri(t,e,n,r,i,o){var a=f(t),l=f(e),c=a?ti:Ze(t),s=l?ti:Ze(e),u=(c=c==Zr?ei:c)==ei,h=(s=s==Zr?ei:s)==ei,p=c==s;if(p&&Et(t)){if(!Et(e))return!1;a=!0,u=!1}if(p&&!u)return o||(o=new Qn),a||It(t)?Vr(t,e,n,r,i,o):function(t,e,n,r,i,o,a){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!o(new jr(t),new jr(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return V(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var l=Jr;case"[object Set]":var c=1&r;if(l||(l=Qr),t.size!=e.size&&!c)return!1;var s=a.get(t);if(s)return s==e;r|=2,a.set(t,e);var u=Vr(l(t),l(e),r,i,o,a);return a.delete(t),u;case"[object Symbol]":if(Yr)return Yr.call(t)==Yr.call(e)}return!1}(t,e,c,n,r,i,o);if(!(1&n)){var d=u&&ni.call(t,"__wrapped__"),g=h&&ni.call(e,"__wrapped__");if(d||g){var y=d?t.value():t,m=g?e.value():e;return o||(o=new Qn),i(y,m,n,r,o)}}return!!p&&(o||(o=new Qn),function(t,e,n,r,i,o){var a=1&n,l=vr(t),c=l.length;if(c!=vr(e).length&&!a)return!1;for(var s=c;s--;){var u=l[s];if(!(a?u in e:Kr.call(e,u)))return!1}var f=o.get(t),h=o.get(e);if(f&&h)return f==e&&h==t;var p=!0;o.set(t,e),o.set(e,t);for(var d=a;++s<c;){var g=t[u=l[s]],y=e[u];if(r)var m=a?r(y,g,u,e,t,o):r(g,y,u,t,e,o);if(!(void 0===m?g===y||i(g,y,n,r,o):m)){p=!1;break}d||(d="constructor"==u)}if(p&&!d){var b=t.constructor,v=e.constructor;b==v||!("constructor"in t)||!("constructor"in e)||"function"==typeof b&&b instanceof b&&"function"==typeof v&&v instanceof v||(p=!1)}return o.delete(t),o.delete(e),p}(t,e,n,r,i,o))}function ii(t,e,n,r,i){return t===e||(null==t||null==e||!S(t)&&!S(e)?t!=t&&e!=e:ri(t,e,n,r,ii,i))}function oi(t){return t==t&&!A(t)}function ai(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}function li(t){var e=function(t){for(var e=Xt(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,oi(i)]}return e}(t);return 1==e.length&&e[0][2]?ai(e[0][0],e[0][1]):function(n){return n===t||function(t,e,n,r){var i=n.length,o=i,a=!r;if(null==t)return!o;for(t=Object(t);i--;){var l=n[i];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++i<o;){var c=(l=n[i])[0],s=t[c],u=l[1];if(a&&l[2]){if(void 0===s&&!(c in t))return!1}else{var f=new Qn;if(r)var h=r(s,u,c,t,e,f);if(!(void 0===h?ii(u,s,3,r,f):h))return!1}}return!0}(n,t,e)}}function ci(t,e){return null!=t&&e in Object(t)}function si(t,e){return null!=t&&function(t,e,n){for(var r=-1,i=(e=pt(e,t)).length,o=!1;++r<i;){var a=dt(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++r!=i?o:!!(i=null==t?0:t.length)&&Ct(i)&&Ht(a,i)&&(f(t)||Tt(t))}(t,e,ci)}function ui(t){return O(t)?tn(dt(t)):function(t){return function(e){return gt(e,t)}}(t)}function fi(t){return"function"==typeof t?t:null==t?Zt:"object"==typeof t?f(t)?function(t,e){return O(t)&&oi(e)?ai(dt(t),e):function(n){var r=yt(n,t);return void 0===r&&r===e?si(n,t):ii(e,r,3)}}(t[0],t[1]):li(t):ui(t)}function hi(t,e){var n=-1,r=Qt(t)?Array(t.length):[];return Kt(t,function(t,i,o){r[++n]=e(t,i,o)}),r}function pi(t){return!!function(t){return"[object Undefined]"===Object.prototype.toString.call(t)}(t)||(!!function(t){return"[object Null]"===Object.prototype.toString.call(t)}(t)||(!!function(t){if(En(t)){for(let e in t)return!1;return!0}return!1}(t)||(!!function(t){return!(!bn(t)||""!==t)}(t)||(!!function(t){return!!An(t)&&0===t.length}(t)||!!Hn(t)))))}async function di(t,e={}){let n=yt(e,"tableBorderColor","");vn(n)||(n="#666");let c=yt(e,"fontFamilies",[]);var s,u,h;(!An(s=c)||0===s.length||1===s.length&&pi(s[0]))&&(c=["Microsoft JhengHei","Avenir","Helvetica","Arial","sans-serif"]),c=Ae((h=t=>`'${t}'`,(f(u=c)?ct:hi)(u,fi(h))),", ");let p=yt(e,"fontSizeUnit","");vn(p)||(p="pt");let d=yt(e,"fontSizeScale","");Cn(d)||(d=1),d=Bn(d);let g=yt(e,"fontSizeDef","");vn(g)||(g=12*d+p);let y=yt(e,"fontSizeH1","");vn(y)||(y=20*d+p);let m=yt(e,"fontSizeH2","");vn(m)||(m=16*d+p);let b=yt(e,"fontSizeH3","");vn(b)||(b=14*d+p);let v=yt(e,"fontSizeH4","");vn(v)||(v=12*d+p);let _=yt(e,"fontSizeH5","");vn(_)||(_=12*d+p);let w=yt(e,"fontSizeH6","");vn(w)||(w=12*d+p);let j=yt(e,"fontSizeP","");vn(j)||(j=12*d+p);let S=yt(e,"fontSizeTab","");vn(S)||(S=11*d+p);let x=yt(e,"fontSizeCode","");vn(x)||(x=10*d+p);let T=yt(e,"textAlignH1","");vn(T)||(T="left");let k=yt(e,"textAlignH2","");vn(k)||(k="left");let O=yt(e,"textAlignH3","");vn(O)||(O="left");let A=yt(e,"textAlignH4","");vn(A)||(A="left");let E=yt(e,"textAlignH5","");vn(E)||(E="left");let z=yt(e,"textAlignH6","");vn(z)||(z="left");let H=yt(e,"imgWidthMax",null);Cn(H)&&(H=`${H}px`),vn(H)||(H="");let C=yt(e,"funWalkTokens",null),B=yt(e,"mergeStyle",null);mn(B)||(B=!1);let N=new r.Marked;N.use(i({throwOnError:!1,nonStandard:!0})),N.use(o()),N.use(l.markedHighlight({langPrefix:"hljs language-",emptyLangClass:"hljs",highlight(t,e){let n=e&&a.getLanguage(e)?e:"plaintext";return a.highlight(t,{language:n}).value}}));let $={async:!0,renderer:{image:({href:t,title:e,text:n})=>{let r=vn(e)?`title="${e}"`:"",i="";return vn(H)&&(i=`max-width:${H}; height:auto;`),`<img src="${t}" alt="${n}" ${r} style="${i}">`}}};_n(C)&&($.walkTokens=C),N.use($);let D=await N.parse(t);D=`\n        <div class="md" style="contain:layout;">\n            ${D}\n        </div>\n    `;let P=["https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css","https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css"],F='\n\n.md {\n    font-family: {fontFamilies};\n    font-size: {fontSizeDef};\n}\n\n.md table {\n    border-collapse: collapse;\n    margin: 0;\n    padding: 0;\n    word-break: initial;\n    font-family: {fontFamilies};\n    font-size: {fontSizeTab};\n}\n\n.md tr {\n    margin: 0;\n    padding: 0;\n}\n\n.md table tr th {\n    font-weight: bold;\n    background: #eee;\n    border: 1px solid {tableBorderColor};\n    border-bottom: 0;\n    margin: 0;\n    padding: 6px 13px;\n}\n\n.md table tr td {\n    border: 1px solid {tableBorderColor};\n    margin: 0;\n    padding: 6px 13px;\n}\n\n.md h1 {\n    display: block;\n    font-size: {fontSizeH1};\n    margin: 1rem 0;\n    padding: 0;\n    font-weight: bold;\n    text-align: {textAlignH1};\n}\n\n.md h2 {\n    display: block;\n    font-size: {fontSizeH2};\n    margin: 1rem 0;\n    padding: 0;\n    font-weight: bold;\n    text-align: {textAlignH2};\n}\n\n.md h3 {\n    display: block;\n    font-size: {fontSizeH3};\n    margin: 1rem 0;\n    padding: 0;\n    font-weight: bold;\n    text-align: {textAlignH3};\n}\n\n.md h4 {\n    display: block;\n    font-size: {fontSizeH4};\n    margin: 1rem 0;\n    padding: 0;\n    font-weight: bold;\n    text-align: {textAlignH4};\n}\n\n.md h5 {\n    display: block;\n    font-size: {fontSizeH5};\n    margin: 1rem 0;\n    padding: 0;\n    font-weight: bold;\n    text-align: {textAlignH5};\n}\n\n.md h6 {\n    display: block;\n    font-size: {fontSizeH6};\n    margin: 1rem 0;\n    padding: 0;\n    font-weight: bold;\n    text-align: {textAlignH6};\n}\n\n.md p {\n    display: block;\n    font-size: {fontSizeP};\n    margin: 1rem 0;\n    padding: 0;\n} \n\n.md ol {\n    display: block;\n    list-style-type: decimal;\n    margin: 1rem 0;\n    padding: 0;\n    padding-inline-start: 40px;\n} \n\n.md li {\n    display: list-item;\n    /* margin: 0.4rem 0; */ /* 須個別元素用style給予才能用於docx */\n    padding: 0;\n}\n\n.md blockquote {\n    font-style: italic;\n    border-left: 5px solid #debc76;\n    background: #f9f2e3;\n    margin: 1rem 0;\n    padding: 0.1rem 1.0rem 0.1rem 1.0rem;\n}\n\n.md pre {\n    display: block;\n    font-size: {fontSizeCode};\n    overflow: auto;\n    background: #eee;\n    margin: 1rem 0;\n    padding: 0;\n}\n.md pre code.hljs {\n    background: transparent !important;\n    line-height: 1.6 !important;\n}\n\n.md code {\n    font-family: Consolas, "Courier New", monospace;\n}\n\n.md a {\n    color: #0066cc;\n    cursor: pointer;\n}\n\n.md a[data-footnote-ref]::before {\n    content: "[";\n}\n.md a[data-footnote-ref]::after {\n    content: "]";\n}\n.md sup:has(a[data-footnote-ref]) {\n    position: relative;\n    vertical-align: baseline; /* 不要推高行距 */\n    top: -0.5em;              /* 往上移動看起來像上標 */\n    line-height: 0;           /* 避免影響行距 */\n}\n\n.md hr {\n    margin: 2rem 0;\n    padding: 0;\n}\n\n.md section {\n    margin: 0;\n    padding: 0;\n}\n\n    ';F=jn(F,"{fontFamilies}",c),F=jn(F,"{fontSizeDef}",g),F=jn(F,"{fontSizeH1}",y),F=jn(F,"{fontSizeH2}",m),F=jn(F,"{fontSizeH3}",b),F=jn(F,"{fontSizeH4}",v),F=jn(F,"{fontSizeH5}",_),F=jn(F,"{fontSizeH6}",w),F=jn(F,"{fontSizeP}",j),F=jn(F,"{fontSizeTab}",S),F=jn(F,"{fontSizeCode}",x),F=jn(F,"{textAlignH1}",T),F=jn(F,"{textAlignH2}",k),F=jn(F,"{textAlignH3}",O),F=jn(F,"{textAlignH4}",A),F=jn(F,"{textAlignH5}",E),F=jn(F,"{textAlignH6}",z),F=jn(F,"{tableBorderColor}",n);let L={};if(B){let t="\n";te(P,e=>{t+=`<link rel="stylesheet" href="${e}">\n`}),t+=`<style>${F}</style>\n`,t+=D,L={html:t,styleSrcs:[],styleDef:""}}else L={html:D,styleSrcs:P,styleDef:F};return L}return async function(n,r,i={}){if(!Vn(n))return Promise.reject(`fpIn[${n}] does not exist`);let o=Gn(n=t.resolve(n)),a=yt(i,"htmlTemp",null);vn(a)||(a='\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="utf-8" />\n    <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n    <meta http-equiv="Cache-Control" content="no-siteapp"/>\n    <meta name="renderer" content="webkit" />\n    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />\n    <title>{title}</title>\n</head>\n<body style="padding:20px; margin:0; overflow-y:auto;">\n    {html}\n</body>\n</html>\n');let l=yt(i,"imgConvertToBase64",null);mn(l)||(l=!0);let c=yt(i,"funProcFpOut"),s=(t,e)=>{let n=_e(t,"\n"),r=0,i=[],o={};te(n,t=>{let n=t;if(t.indexOf(`${e}n`)>=0){r++;let i=`${e}${r}`;n=jn(t,`${e}n`,i);let a=t;a=On(a),a=jn(a,`${e}n`,""),a=ke(a),a=`{${a}}`,o[a]=i}i.push(n)});let a=Ae(i,"\n");return te(o,(t,e)=>{a=a.replaceAll(e,t)}),a},f=Wn(n),h=Gn(n),p=e.readFileSync(n,"utf8"),d=(t=>{let e=_e(t,"\n"),n="";return te(e,(t,r)=>{if(t.indexOf(" pretitle ")>=0)return n=yt(e,r+1,""),n=ke(n),!1}),n})(p);p=s(p,"圖"),p=s(p,"表"),p=await(async(t,e)=>{let n=[],r=_e(e,"\n");return await zn(r,async e=>{e.indexOf('src="')>=0&&(e=await(async e=>{let n=_e(e,'src="');if(2!==yn(n))throw new Error("size(s)!==2");let r=n[0],i=_e(n[1],'"'),o=i[0],a="";if(Vn(o))a=o;else if(a=`${t}/${o}`,!Vn(a))throw console.log("c",e),console.log("fnp",o),new Error(`fp[${a}] does not exist`);let l=await Mr(a,"png");return i=Pe(i),r+'src="'+l+'"'+Ae(i,'"')})(e)),n.push(e)}),n=Ae(n,"\n"),n})(h,p);let g=a;return g=jn(g,"{html}",yt(await di(p,{...i,funWalkTokens:async e=>{if("image"===e.type&&l)try{let n=t.resolve(o,e.href);Vn(n)?e.href=await Mr(n,"png"):console.log(`href[${e.href}] does not exist`)}catch(t){console.log(t)}},mergeStyle:!0}),"html","")),g=jn(g,"{title}",f),g=jn(g,'<h2 id="footnote-label" class="sr-only">Footnotes</h2>','<h2 id="footnote-label" class="sr-only" style="height:0px; line-height:0px; min-height:0px; overflow:hidden;">Footnotes</h2>'),g=g.replaceAll("<li>",'<li style="margin:7px 0;">'),g=g.replaceAll("<docx_br>",'\n<div style="height:0; overflow:hidden;">\n    <br>\n</div>    \n        '),g=(t=>{let e=u.load(t);return e('[style*="display:none"]').remove(),e.html()})(g),_n(c)&&wn(r=c({fpOut:r,pretitle:d}))&&(r=await r),e.writeFileSync(r,g,"utf8"),"ok"}});
//# sourceMappingURL=w-md2html.umd.js.map
